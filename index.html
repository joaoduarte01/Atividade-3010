<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gerenciador de Tarefas - Kanban</title>
<link rel="stylesheet" href="styles.css">
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  form { margin-bottom: 20px; }
  input, select, button { margin: 5px; padding: 8px; }
  .kanban { display: flex; gap: 10px; }
  .coluna { flex: 1; background: #f4f4f4; padding: 10px; border-radius: 8px; }
  .tarefa { background: #fff; margin: 5px 0; padding: 8px; border-radius: 5px; }
  .alta { border-left: 5px solid red; }
  .media { border-left: 5px solid orange; }
  .baixa { border-left: 5px solid green; }
  #cadastroUsuarios { display: none; margin-bottom: 20px; background: #f0f0f0; padding: 15px; border-radius: 8px; }
</style>
</head>
<body>

<h1>Gerenciador de Tarefas - Kanban</h1>

<button onclick="abrirCadastroUsuarios()">Tela de Cadastro de Usuários</button>

<!-- Tela de Cadastro de Usuários -->
<div id="cadastroUsuarios">
  <h2>Cadastro de Usuários</h2>
  <form id="formUsuario">
    <input type="text" id="novoNome" placeholder="Nome do Usuário" required>
    <input type="email" id="novoEmail" placeholder="E-mail do Usuário" required>
    <button type="submit">Cadastrar Usuário</button>
    <button type="button" onclick="fecharCadastroUsuarios()">Fechar</button>
  </form>
  <ul id="listaUsuarios"></ul>
</div>

<!-- Formulário principal de tarefas -->
<form id="formTarefa">
  <select id="usuarioSelecionado" required>
    <option value="">Selecione um Usuário</option>
  </select>
  <input type="text" id="descricao" placeholder="Descrição da Tarefa" required>
  <input type="text" id="setor" placeholder="Nome do Setor" required>
  <select id="prioridade" required>
    <option value="">Prioridade</option>
    <option value="baixa">Baixa</option>
    <option value="media">Média</option>
    <option value="alta">Alta</option>
  </select>
  <button type="submit">Adicionar Tarefa</button>
</form>

<div class="kanban">
  <div class="coluna" id="aFazer"><h2>A Fazer</h2></div>
  <div class="coluna" id="fazendo"><h2>Fazendo</h2></div>
  <div class="coluna" id="pronto"><h2>Pronto</h2></div>
</div>

<script>
  let tarefas = JSON.parse(localStorage.getItem("tarefas")) || [];
  let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];

  atualizarListaUsuarios();

  // ---- CADASTRO DE USUÁRIOS ----
  document.getElementById("formUsuario").addEventListener("submit", (e) => {
    e.preventDefault();
    const nome = document.getElementById("novoNome").value.trim();
    const email = document.getElementById("novoEmail").value.trim();

    if (!nome || !email) {
      alert("Preencha todos os campos!");
      return;
    }

    if (usuarios.some(u => u.email === email)) {
      alert("E-mail já cadastrado!");
      return;
    }

    const usuario = { id: usuarios.length + 1, nome, email };
    usuarios.push(usuario);
    localStorage.setItem("usuarios", JSON.stringify(usuarios));

    atualizarListaUsuarios();
    e.target.reset();
    alert("Usuário cadastrado com sucesso!");
  });

  function abrirCadastroUsuarios() {
    document.getElementById("cadastroUsuarios").style.display = "block";
    renderizarUsuarios();
  }

  function fecharCadastroUsuarios() {
    document.getElementById("cadastroUsuarios").style.display = "none";
  }

  function renderizarUsuarios() {
    const lista = document.getElementById("listaUsuarios");
    lista.innerHTML = "";
    usuarios.forEach(u => {
      const li = document.createElement("li");
      li.textContent = `${u.nome} (${u.email})`;
      lista.appendChild(li);
    });
  }

  function atualizarListaUsuarios() {
    const select = document.getElementById("usuarioSelecionado");
    select.innerHTML = '<option value="">Selecione um Usuário</option>';
    usuarios.forEach(u => {
      const option = document.createElement("option");
      option.value = u.id;
      option.textContent = u.nome;
      select.appendChild(option);
    });
  }

  // ---- CADASTRO DE TAREFAS ----
  document.getElementById("formTarefa").addEventListener("submit", (e) => {
    e.preventDefault();

    const idUsuario = document.getElementById("usuarioSelecionado").value;
    const descricao = document.getElementById("descricao").value.trim();
    const setor = document.getElementById("setor").value.trim();
    const prioridade = document.getElementById("prioridade").value;

    if (!idUsuario || !descricao || !setor || !prioridade) {
      alert("Preencha todos os campos!");
      return;
    }

    const tarefa = {
      idTarefa: tarefas.length + 1,
      idUsuario: parseInt(idUsuario),
      descricao,
      setor,
      prioridade,
      data: new Date().toLocaleDateString("pt-BR"),
      status: "aFazer"
    };

    tarefas.push(tarefa);
    localStorage.setItem("tarefas", JSON.stringify(tarefas));
    renderizar();
    e.target.reset();
  });

  // ---- RENDERIZAÇÃO DO KANBAN ----
  function renderizar() {
    ["aFazer", "fazendo", "pronto"].forEach(coluna => {
      document.getElementById(coluna).innerHTML = `<h2>${coluna.charAt(0).toUpperCase() + coluna.slice(1)}</h2>`;
    });

    tarefas.forEach(t => {
      const usuario = usuarios.find(u => u.id === t.idUsuario);
      const div = document.createElement("div");
      div.className = `tarefa ${t.prioridade}`;
      div.innerHTML = `
        <strong>${t.descricao}</strong><br>
        Usuário: ${usuario ? usuario.nome : "Desconhecido"}<br>
        Setor: ${t.setor}<br>
        Prioridade: ${t.prioridade.toUpperCase()}<br>
        Data: ${t.data}<br>
        <select onchange="atualizar(${t.idTarefa}, this)">
          <option value="aFazer" ${t.status === "aFazer" ? "selected" : ""}>A Fazer</option>
          <option value="fazendo" ${t.status === "fazendo" ? "selected" : ""}>Fazendo</option>
          <option value="pronto" ${t.status === "pronto" ? "selected" : ""}>Pronto</option>
        </select>
        <select onchange="mudarPrioridade(${t.idTarefa}, this)">
          <option value="baixa" ${t.prioridade === "baixa" ? "selected" : ""}>Baixa</option>
          <option value="media" ${t.prioridade === "media" ? "selected" : ""}>Média</option>
          <option value="alta" ${t.prioridade === "alta" ? "selected" : ""}>Alta</option>
        </select>
      `;
      document.getElementById(t.status).appendChild(div);
    });
  }

  function atualizar(id, select) {
    const tarefa = tarefas.find(t => t.idTarefa === id);
    tarefa.status = select.value;
    localStorage.setItem("tarefas", JSON.stringify(tarefas));
    renderizar();
  }

  function mudarPrioridade(id, select) {
    const tarefa = tarefas.find(t => t.idTarefa === id);
    tarefa.prioridade = select.value;
    localStorage.setItem("tarefas", JSON.stringify(tarefas));
    renderizar();
  }

  renderizar();
</script>
</body>
</html>
